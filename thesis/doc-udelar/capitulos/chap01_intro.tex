\chapter{Introducción}

  Utilizar la bicicleta como medio de transporte brinda un amplio espectro de beneficios. Es una alternativa particularmente favorable para viajes cortos en comparación al uso de automóvil o transporte colectivo \parencite{Hull2014}. La sustitución del transporte motorizado por bicicleta es favorable para el descongestionamiento de calles y la consiguiente disminución en la contaminación sonora y del aire, problemas que son comunes en ciudades medianas y grandes. En Uruguay, una proporción significativa de la población padece enfermedades no transmisibles asociadas a la inactividad física como enfermedades cardiovasculares y obesidad; está demostrado que la práctica de ejercicio frecuente de moderada intensidad como el transporte en bicicleta, junto a otros cambios en el estilo de vida, previene el desarrollo de los factores de riesgo más prevalentes \parencite{heartrisksuy, mspphisicalactivityguid, mspsurveyriskfactors}. Sin embargo, a pesar de las ventajas citadas anteriormente, no siempre es posible utilizar este medio de transporte debido a factores como la distancia del viaje, condiciones climáticas adversas y falta de infraestructura adecuada, entre otros.

  Según la última encuesta de movilidad realizada para el área metropolitana de la ciudad de Montevideo \parencite{Mauttone2017a}, la utilización de la bicicleta abarca el 2,6\% del total de los viajes diarios. Además, se desprende de dicho estudio que que la bicicleta es el medio de transporte privado de distribución más equitativa, por su presencia en similares valores entre hogares de diferentes estratos socioeconómicos. En Latinoamérica, la utilización de la bicicleta no dista mucho del caso de Montevideo, ver Tabla \ref{table:bicycleusagelatinamerica}, y en general está lejos de los niveles que se pueden ver en otras partes del mundo. Podemos encontrar valores altos en el porcentaje de utilización de la bicicleta en algunas ciudades de Europa que cuentan con buenos niveles de servicio en ciclovías, por ejemplo Cambridge, Reino Unido, con 20\%; Amsterdam y Utrecht, Holanda con 37\% y 44\% respectivamente \parencite{Hull2014}; y Copenhague, Dinamarca con el 35\% \parencite{Vedel2017}. Por otro lado, algunas ciudades de China cuyo medio de transporte predominante ha sido la bicicleta, llegando a niveles superiores al 50\% a principios de este siglo, están viendo decrecer su utilización a razón de 1\% anual en promedio \parencite{Li2017}.

  \begin{table}[h!]
    \centering
      \begin{tabular}{lcS}
      \toprule
      País & Ciudad & \shortstack{Viajes en bicicleta (\%)} \\
      \midrule
        Argentina & Buenos Aires & 3,0 \\
        Argentina & Rosario & 5,3 \\
        Brasil & Río de Janeiro & 3,2 \\
        Brasil & San Pablo & 1,0 \\
        Chile & Santiago de Chile & 3,0 \\
        Chile & Validivia & 2,0 \\
        Colombia & Bogotá & 5,0 \\
        México & Mexico D.F. & 2,0 \\
        Peru & Lima & 0,3 \\
        Uruguay & Montevideo & 2,6 \\
      \bottomrule
    \end{tabular}
      \caption{Porcentaje de viajes en bicicleta sobre el total de viajes realizados en un día típico para algunas ciudades de Latinoamérica \parencite{rios2015}.}
      \label{table:bicycleusagelatinamerica}
  \end{table}

  Si bien la bicicleta puede utilizar la red de calles o incluso sendas peatonales como medio de circulación, no siempre estas son elegibles por los ciclistas para su uso. Factores como el volumen y la velocidad del tránsito automotor afectan considerablemente esta decisión. La necesidad de infraestructura específica para la bicicleta es ampliamente reconocida y un correcto diseño es clave para la aplicación eficiente de políticas públicas que busquen mejorar e incentivar la bicicleta como medio de transporte alternativo \parencite{Hunt2007}. En este sentido, la toma de decisiones que lleva a un buen diseño de una red de ciclovías un es problema complejo influido por múltiples factores como las características topológicas de la ciudad, la demanda de viajes y el presupuesto disponible. Desde la optimización se pueden aportar herramientas que ayudan y dan soporte a estas decisiones.

  \section{Conceptos y estado del arte}

  % Orden de las cosas:
  % - Definiciones
  % - Casos de estudio de transporte en bicicleta
  % - Casos de estudio de transferencia de demanda
  % - Casos de estudio del comportamiento de los usuarios

  % ---Definiciones

  La planificación de ciclovías es un problema conocido en el área de Investigación Operativa y ha sido tratado de varias formas. Al igual que otros problemas del área de transporte urbano, el marco de trabajo es una red que representa un área geográfica, por ejemplo la red de calles de una ciudad donde los nodos representan la intersección de calles y los arcos cada segmento de una calle que une un par de intersecciones; una matriz origen-destino que detalla la demanda de viajes o cantidad de viajes entre pares de nodos de la red (pares origen-destino). Además, se consideran diferentes costos, como el costo percibido por cada unidad de demanda al atravesar un arco de la red (típicamente, distancia o tiempo) y el costo de las instalaciones que se pueden construir sobre arcos y nodos de la red (típicamente, costo monetario). Generalmente, las instalaciones pueden ser infraestructura de ciclovía, estacionamientos o {\it dock stations} para los sistemas de bicicletas compartidas. A diferencia de otros medios de transporte, en este tipo de problemas se puede considerar que la red subyacente es transitable por los ciclistas sin necesidad de instalaciones específicas. En otras palabras, en una ciudad sin infraestructura específica de ciclovías, se puede asumir que es posible circular en bicicleta utilizando la red de calles, compartiendo espacio con vehículos motorizados.

  A continuación describimos los trabajos más significativos en metodologías de optimización aplicadas al diseño de ciclovías, modelado de transferencia de demanda, modelos de comportamiento de usuarios y técnicas generales de optimización de redes de transporte.

  % ---Transporte en bicicleta
  % Ordenado por año
  % - Taylor1999, Buehler2016: La relevancia de modelar el problema de planificación de ciclovías como un problema de redes de transporte ha sido
  % resaltado por ....
  % - Lin2013: Uno de los primeros trabajos que afronta el problema de diseño de ciclovías. Es un modelo multiobjetivo cuyos cuatro objetivos son: que minimiza el riesgo de los ciclistas, maximiza su confort, maximiza la cobertura del servicio y minimiza el impacto de las ciclovías en el tráfico. La formulación resultante es compleja, considera tres tipos de infraestructuras de ciclovías y fue aplicada a una región de la ciudad de Taipei modelada como una red de 75 nodos y 115 arcos, resuelta utilizando un solver comercial. La inaplicabilidad de esta formulación a regiones más grandes esta dada,dicen, por la dificultad en el manejo de los datos y no necesariamente por la complejidad.
  % - Duthie2014: Buscan, minimizando el costo de construcción de ciclovías en arcos y nodos, conectar todos los pares origen-destino con caminos cubiertos por ciclovías restringiendo el desvío en el largo del camino respecto al camino más corto. Utilizaron un único tipo de infraestructura y resolvieron de forma óptima utilizando un solver MILP comercial una red que modela la ciudad de Austin, Estados Unidos con 75 nodos y 185 arcos utilizando 5,625 pares origen-destino.
  % - Mauttone2017, baya2021:
  % - Liu2019: Planten un modelo binivel que maximiza la utilidad de los ciclistas, sujeto a presupuesto, que se trasladan según una matriz origen-destino. El segundo nivel representa el comportamiento de los usuarios mediante un modelo logístico en función un escalar que captura los factores que afectan a los ciclistas en sus decisiones: largo de la ruta, frecuencia de curvas, pendiente y presencia de ciclovía. Para resolver el modelo primero fue reformulado con lo que pudieron resolver instancias medianas con solvers MILP comerciales. Para resolver instancias grandes desarrollaron una heurística que achicaba la región factible del problema y asi resolverlo con un solver ya mencionado.
% - lim2021: mencionar trabajo pero por arriba diciendo que no esta revisado.

  En \textcite{Lin2013} podemos encontrar uno de los primeros trabajos publicados que afrontan el problema de diseño de ciclovías como un problema de diseño de redes. Plantean un modelo multiobjetivo que minimiza el riesgo de los ciclistas, maximiza su confort, maximiza la cobertura de las ciclovías y minimiza el impacto en el tráfico. Consideran tres tipos de tecnologías de ciclovía. La formulación resultante es un problema lineal entero mixto (MILP) y fue aplicada a una región de la ciudad de Taipei, China, modelada como una red de 75 nodos y 115 arcos, resuelta utilizando un solver MILP comercial. Luego, en \textcite{Duthie2014} se propone un modelo que busca minimizar el costo de construcción de ciclovías en arcos y nodos, dado que todos los pares origen-destino estén conectados por caminos en los que hay ciclovía y restringiendo el desvío del largo de los caminos sobre la ciclovía respecto a un factor multiplicado por el largo del camino más corto sobre la red de calles. Los autores utilizaron un único tipo de tecnología de ciclovía y resolvieron de forma óptima utilizando un solver MILP comercial el problema sobre una red de la ciudad de Austin, Estados Unidos con 75 nodos y 185 arcos, utilizando 5625 pares origen-destino. Más tarde, \textcite{Mauttone2017} introducen un modelo MILP que, mediante la construcción de infraestructuras de ciclovías que reducen el costo de usuario de atravesar los arcos en los que se construyen, minimiza la suma de los costos de usuario de trasladarse por el camino de menor costo desde los orígenes a los destinos. En este trabajo se utilizó un único tipo de tecnología de ciclovía y se logran resolver de manera óptima instancias pequeñas utilizando un solver comercial, por lo que propusieron una metaheurística GRASP para resolver instancias grandes. La metaheurística incluye un parámetro para penalizar la discontinuidades de las ciclovías, entendiéndose como discontinuidad la cantidad de veces que un usuario sale de la red de ciclovías (hacia la red de calles) durante su recorrido. Luego, en \textcite{baya2021} se estudia un problema similar pero considerando múltiples tipos de tecnologías de ciclovías y las discontinuidades dentro de un modelo de programación matemática. Los autores logran resolver de manera óptima utilizando un solver MILP comercial una red que modela la ciudad de Montevideo con 136 nodos y 636 arcos. Por otro lado, en \textcite{Liu2019} se plantea un modelo binivel donde el primer nivel maximiza la utilidad de los ciclistas que se trasladan según una matriz origen-destino, sujeto a presupuesto. El segundo nivel representa el comportamiento de los usuarios mediante un modelo {\it logit} en función del valor de utilidad percibida por los usuarios. Este es un valor escalar que captura los factores que afectan a los ciclistas en sus decisiones: largo de la ruta, frecuencia de curvas, pendiente y presencia de ciclovía. Para resolver el modelo primero fue reformulado en un MILP con lo que pudieron resolver instancias medianas con solvers comerciales. Para resolver instancias grandes desarrollaron una metaheurística que reduce la región factible del problema para luego ser resuelto con el mismo MILP que habían desarrollado. Más recientemente, en \textcite{lim2021}\footnote{Este trabajo no se encuentra publicado en un medio revisado por pares pero sí está disponible en el repositorio arXiv.} se propone un modelo en el que se planifica la red de ciclovías considerando que la demanda de cada par origen-destino puede ser satisfecha si se cumple que existe un camino de ciclovías que conecta el origen y el destino; y el desvío del largo del camino sobre la ciclovía sobre el largo del camino más corto sobre la red de calles no supera un umbral. El modelo minimiza la penalización sobre el valor de desvío que se modela en la función objetivo como una función lineal de a partes. Logran resolver una instancia que modela la red de calles de una sección de la ciudad de Atlanta, Estados Unidos, con 5815 nodos y 11329 arcos, utilizando el algoritmo de descomposición de Benders.

  % ---Transferencia de demanda: Los que menciono son todos iguales
  %
  % - garcia2005: Donde construir lineas de metro y estaciones para que la mayor cantidad de demanda use el tren. Mismo problema que el mio pero para trenes. Transferencia modelada como all-or-nothing.
  % - laporte2007:
  % - marin2007:
  % - cadarso2015: (igual a los 3 anteriores)

  La transferencia de demanda entre modos de transporte, entendida como el proceso en el cual los usuarios deciden cambiar el modo de transporte para trasladarse entre dos puntos, ha sido un tema abordado principalmente de dos maneras en la literatura: con modelos deterministas mediante los cuales la demanda se transfiere entre modos dependiendo de un valor en el costo o utilidad de los usuarios; y modelos probabilísticos en los que dependiendo de la utilidad de utilizar cada modo de transporte obtenemos su probabilidad de utilización y en base a esto un valor de demanda esperado de utilización de cada medio. Sobre los primeros, múltiples autores han estudiado problemas de optimización sobre la demanda que se transfiere a cierto medio de transporte en función del costo de usuario. Este es el caso en \textcite{garcia2005} y \textcite{laporte2007} en los que tratan distintas variantes del {\it Rapid Transit Network Design Problem} o diseño de redes aplicado al transporte de metro y trenes, en los cuales se planifican las líneas y estaciones a construir para satisfacer la mayor demanda posible. El objetivo en estos trabajos es maximizar la cobertura de viajes por parte de la red de trenes. En este caso el término {\it cobertura} de viajes refiere a la demanda que puede ser satisfecha por la red que está siendo diseñada en lugar de que ésta utilice transporte privado (automóvil particular), por lo que el concepto es equivalente a lo que entendemos por transferencia de demanda en nuestro trabajo. El modelado de la cobertura de demanda se realizó con un criterio {\it all-or-nothing}, lo que significa que si el costo de usuario de ir de un origen a un destino utilizando la red en construcción es menor a un valor umbral dado como parámetro para dicho par origen-destino, entonces se considera que la demanda de ese par origen-destino está cubierta. En estos problemas los usuarios solo se pueden trasladar por arcos y nodos donde hay líneas y estaciones de trenes activas y se maneja un parámetro de congestión que modela la capacidad de los trenes. A su vez hay límites de presupuesto para el costo total de las instalaciones y límites en el largo de las líneas. Los problemas fueron formulados como MILP y resueltos utilizando solvers comerciales. Luego, en \textcite{marin2007} y \textcite{cadarso2015} se formulan problemas similares pero considerando múltiples objetivos. En el primero se agrega el objetivo de minimizar el costo total de los trayectos y en el segundo se agrega a lo anterior la minimización de los costos de las instalaciones.

  Por el otro lado, sobre los modelos probabilísticos del modelado de transferencia de demanda podemos encontrar en \textcite{ortuz2011} la definición de modelos de elección discreta (DCM, siglas de la traducción al inglés, Discrete Choice Models). En estos modelos se define el concepto de utilidad, que es una construcción teórica definida como lo que el individuo busca maximizar. En el contexto de nuestro trabajo, la utilidad de un individuo de utilizar un medio de transporte se definiría en función de variables o indicadores que tomen en cuenta cualquier tipo de información trascendente al problema sobre el individuo y el trayecto, por ejemplo: nivel socioeconómicos, disponibilidad de vehículos, tiempo de viaje en bicicleta, etc. Además, se le suma un componente aleatorio de media cero que representa los factores que escapan a lo considerado al calcular la utilidad. Luego, para determinar la probabilidad de que un individuo utilice cierto modo de transporte en base a los valores de utilidad que percibe para cada modo se utilizan modelos matemáticos como {\it logit} o {\it probit}. Por ejemplo, la probabilidad de que un individuo utilice la bicicleta para su traslado en lugar de hacerlo por transporte privado o bus, siendo las utilidades de los diferentes modos $U_{bicicleta}, U_{auto}$ y $U_{bus}$ respectivamente, utilizando el modelo {\it logit}, es: $P_{bicicleta} = {e^{U_{bicicleta}} \over {e^{U_{auto}} + e^{U_{bus}} + e^{U_{bicicleta}}}}$. En \textcite{Pacheco2021} proponen un método por el cual se puede integrar DCM a un MILP siempre y cuando las funciones de utilidad sean lineales, asumiendo que sus variables también son variables del MILP. El método propuesto permite obtener un valor de la demanda esperada que utiliza cada medio de transporte mediante la inclusión de valores sorteados del componente aleatorio de las funciones de utilidad a los parámetros del modelo MILP. Esto funciona siempre y cuando el objetivo del MILP esté en función de las variables de las funciones de utilidad o de la demanda esperada.

  Continuando con los modelos probabilísticos tenemos el enfoque utilizado por \textcite{Liu2019} que aborda el problema de diseño de ciclovías. Definen un MILP con múltiples pares origen-destino y múltiples caminos precomputados para cada par origen-destino. Asumen que toda la demanda se traslada en bicicleta y el objetivo es maximizar la utilidad total de la demanda sobre todos los caminos. El cálculo de demanda que usa cada camino se realiza en base a la probabilidad de utilizarlo, que depende de la utilidad percibida. La utilidad de un par origen-destino sobre cada camino está compuesta por una utilidad fija del camino (parámetro del modelo) y una utilidad variable que depende de la presencia de ciclovías en los arcos del camino. Luego se calcula la demanda esperada sobre cada camino mediante el producto de la demanda total del par origen-destino y la probabilidad de utilización de dicho camino en lugar de los otros caminos del par origen-destino. La probabilidad de utilizar cada camino es calculada utilizando un modelo logístico que involucra el valor de utilidad percibida antes mencionado junto a un factor, conocido como {\it path-size}, que penaliza rutas que comparten arcos con otras rutas. Este tipo de modelos se conocen como modelos {\it path-size logit}.

  Respecto a la demanda transferible a la bicicleta, en \textcite{shwe2014} se realiza una encuesta en algunas ciudades de Europa analizando el potencial de viajes en bicicleta comparándolo con la situación al momento del trabajo. Fijan un umbral de 5 km y consideran que todos los viajes cuyo trayecto es menor a dicha distancia son realizables en bicicleta. Como resultado estiman que, en promedio, la mitad de los viajes podrían ser realizados en bicicleta. Sin embargo, el porcentaje de encuestados que cambiaría su modo de transporte a la bicicleta asumiendo un escenario en donde el mejor tipo de tecnología de ciclovía está disponible de manera continua en todas direcciones y se cuenta con estacionamientos para bicicletas suficientes, es mucho menor al valor potencial anteriormente mencionado. Esto implica, aseguran, que las políticas de construcción de ciclovías deben ser acompañadas de medidas complementarias de promoción y educación sobre este medio de transporte.

  % ---Comportamiento de los usuarios

  El comportamiento de los ciclistas respecto a las decisiones que toman para trazar un camino entre dos puntos se ha analizado en varios trabajos mediante encuestas. A diferencia del transporte vehicular que se sensible al flujo, es decir, el tiempo de viaje es una función creciente del flujo de vehículos, el transporte en bicicleta considera otros factores en la elección de rutas como la seguridad y la presencia de ciclovías. El efecto de la congestión no es un factor significativo en la elección de rutas \parencite{broach2012}. En el estudio \textcite{winters2010} se analiza una encuesta a ciclistas y potenciales ciclistas en Vancouver, Canadá comparando las rutas utilizadas por estos y la ruta más corta en distancia. Encontraron que el 75\% de los viajes en bicicleta estaban dentro del 10\% del camino más corto (factor de desvío $< 1.1$) y el 90\% dentro del 25\% del camino más corto. Si bien estos valores fueron similares para el transporte vehicular, el desvío fue un poco más acentuado para los ciclistas. También se observó que hubieron factores de desvío menores a 1 para algunos ciclistas que utilizaron sendas o vías no transitables. Comparado con los caminos elegidos, los ciclistas pasaron significativamente menos tiempo en vías arteriales y significativamente más tiempo en vías vecinales o con presencia de infraestructura de ciclovía.

  %---Network design en general: del libro Network design

  Como nota final, encontramos en la literatura de optimización sobre redes algunos problemas típicos que pueden ser aplicables a nuestro caso, tomados de \textcite{crainic2021}, manteniendo sus nombres originales:

  \begin{enumerate}
    \item{{\it Fixed-Charge}: este tipo de problemas involucra variables de decisión sobre el diseño de la red en los arcos. Estas variables representan instalaciones, por ejemplo infraestructura de ciclovía o una línea de ómnibus, que si están activas inducen un costo que generalmente se encuentra en el objetivo o como restricción. Luego se puede modelar la demanda de la red de dos formas: como un único tipo de {\it commodity} que puede tener varios nodos orígenes y varios destinos o como múltiples tipos de {\it commodities}. Opcionalmente pueden haber límites en la capacidad de los arcos sobre el flujo de {\it commodities}.}
    \item{{\it Multi-Facility}: Al caso {\it Fixed-Charge} se le agrega que puedan construirse múltiples tipos de instalaciones en los arcos donde cada instalación pueden tener opcionalmente una capacidad diferente.}
    \item{{\it Bilevel}: Este enfoque permite modelar situaciones en las que hay dos entidades jerárquicas potencialmente no alineadas en sus objetivos. El primer nivel realiza decisiones anticipando las decisiones del segundo nivel cuyo objetivo y/o restricciones dependen de las decisiones del primero. Es relevante en el diseño de redes cuando el planificador de las {\it facilities} no tiene control sobre el comportamiento del flujo de {\it commodities}.}
    \item{{\it Piecewise linear costs}: Dado un modelo {\it Fixed-Charge} o {\it Multi-Facility}, en este tipo de problemas se cambia el modelo {\it all-or-nothing} en el cálculos de cierto valor (utilizando variables de decisión) a un método que permite obtener valores funcionales arbitrarios: por ejemplo calcular el costo de la capacidad de un arco en función de las unidades de {\it facilities} construidas. Para integrar esto en una formulación MILP se aproximan las funciones de costos a funciones lineales de a partes. La representación puede terminar siendo escalonada donde cada escalón es constante o una función donde cada escalón tiene su propia pendiente. Este mecanismo tiene sentido con funciones estrictamente crecientes/decrecientes, dependiendo del sentido de la optimización, cuyo valor funcional se encuentra en el objetivo del MILP.}
  \end{enumerate}

  Teniendo en cuenta el estado del arte identificado en esta sección, proponemos en este trabajo un problema de planificación de ciclovías como un modelo de optimización en redes similar a los mencionados basado en el problema {\it fixed-charge multi-commodity} sin considerar capacidad. Modelamos el comportamiento de la demanda teniendo el cuenta las preferencias de los ciclistas respecto a la elección de rutas y la transferencia de demanda de manera determinista utilizando {\it piecewie linear costs}.

  \section{Trabajo desarrollado}

  En este trabajo nos enfocamos en el diseño de redes de ciclovía orientado a la transferencia de demanda hacia la bicicleta. Es decir, el objetivo del problema es maximizar la demanda que se transporta en bicicleta. Para atraer demanda a la bicicleta podemos construir infraestructura de ciclovía que permita mejorar la experiencia de usuario de trasladarse utilizando este medio de transporte y así influir en la decisión de si utilizarlo o no. La infraestructura puede ser de varios tipos de tecnologías que difieren en el costo de construcción y beneficios que brinda al usuario. El diseño de la red de ciclovías refiere a la planificación de dónde y cuales tecnologías de ciclovía construir, dado un presupuesto acotado, para lograr el objetivo. Consideramos que los usuarios se trasladan por el camino de menor costo según un costo de usuario que varía de acuerdo al largo y tipo de tecnología de ciclovía construida en cada arco del camino. Contemplamos múltiples tipos de tecnologías y múltiples pares origen destino y representamos la transferencia de demanda desde un modo de transporte arbitrario (o un agregado de modos de transporte) hacia la bicicleta como funciones que pueden ser arbitrarias.

  Para resolver el problema comenzamos con una formulación binivel, que representa naturalmente lo que queremos resolver, que luego reescribimos como un MILP multiobjetivo que efectivamente podemos resolver. En el Capítulo \ref{sect:problemdefinition} definimos formalmente el problema junto a algunas hipótesis y damos una formulación inicial binivel. Luego, en el Capítulo \ref{sect:problemresolution} nos enfocamos en la resolución práctica y transformación desde formulación binivel a formulación MILP sobre la cual realizamos validaciones numéricas. Finalmente en el Capítulo \ref{sect:problemresults} trabajamos con la formulación final sobre una instancia de la ciudad de Sioux-Falls para realizar un análisis de sensibilidad de los parámetros y luego sobre una instancia de la ciudad de Montevideo como prueba final sobre un caso real.

