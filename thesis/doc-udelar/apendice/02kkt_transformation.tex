\chapter{Transformación por condiciones de KKT}
\label{sec:kkttransform}

Sea la formulación genérica binivel (\ref{bilevelgeneric1})-(\ref{bilevelgeneric6}), del Apéndice \ref{sect:apendixbilevelvalidation}, y sea $f(x, y) = cx + dy$, entonces podemos sustituir el problema de segundo nivel por sus condiciones de optimalidad de KKT agregando las variables $v$ y $u$ de la siguiente manera:

\begin{align}
\max_{x,y}              & \; F(x, y) \label{kktgeneric1} \\
\text{s.t.}             & A_1 x + B_1 y \leq b_1 \\
                        & uA_2 - v = -c \\
                        & u(b_2 - A_2x - B_2y) + vx = 0 \label{kktgeneric_complslack} \\
                        & A_2 x + B_2 y \leq b_2 \label{kktgeneric5} \\
                        & x, y, v, u \geq 0 \label{kktgeneric6}
\end{align}

La restricción (\ref{kktgeneric_complslack}) es problemática dado que el objetivo es resolver el problema con un solver lineal. Aplicando el teorema de holgura complementaria sabemos que ambos sumandos son 0. Luego, podemos reemplazar la restricción $u(b_2 - A_2x - B_2y) = 0$ por dos conjuntos de restricciones equivalentes, agregando variables binarias $z$ y una constante $M$ suficientemente grande, de manera que quede: $u \leq Mz$ y $b_2 - A_2x - B_2y \leq M(1-z)$.

Si aplicamos esta transformación a nuestro problema binivel tendríamos que agregar $|N| |OD|$ variables binarias. Considerando las ya existentes variables $y_{ai}$ y las que agregaremos por temas intrínsecos del problema, entendemos que esto supone una complejidad que supera a la formulación implementada.
